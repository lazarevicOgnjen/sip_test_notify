name: send_email

on:
  schedule:
    - cron: '30 18 20 11 *'

jobs:
  mail:
    runs-on: ubuntu-latest
    steps:
      - name: Send single-recipient e-mail
        env:
          SMTP_SERVER: smtp.gmail.com
          SMTP_PORT:   587
          MAIL_USER:   ${{ secrets.MAIL_USER }}  
          MAIL_PASS:   ${{ secrets.MAIL_PASS }}
          TO_EMAIL:    ${{ secrets.TO_EMAIL }} 
          SUBJECT:     "SIP prijava ispita"
          BODY_TEXT: |
            Prijavi ispite !!!
            
        shell: python
        run: |
          import os, smtplib
          from email.message import EmailMessage

          msg = EmailMessage()
          msg["From"]    = os.getenv("MAIL_USER")
          msg["To"]      = os.getenv("TO_EMAIL")
          msg["Subject"] = os.getenv("SUBJECT")
          msg.set_content(os.getenv("BODY_TEXT"))

          with smtplib.SMTP(os.getenv("SMTP_SERVER"), int(os.getenv("SMTP_PORT"))) as smtp:
              smtp.starttls()
              smtp.login(os.getenv("MAIL_USER"), os.getenv("MAIL_PASS"))
              smtp.send_message(msg)

          print("âœ… E-mail sent!")
